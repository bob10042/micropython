{
  "permissions": {
    "allow": [
      "Bash(git fetch:*)",
      "Bash(git merge:*)",
      "Bash(git log:*)",
      "Bash(git rev-list:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(rm:*)",
      "Bash(gh issue list:*)",
      "Bash(gh issue view:*)",
      "Bash(git checkout:*)",
      "Bash(cat:*)",
      "Bash(powershell -Command \"\n$content = Get-Content ''py/objarray.c'' -Raw\n\n# Fix 1: Add overflow check in array_new\n$oldArrayNew = @''\n#if MICROPY_PY_BUILTINS_BYTEARRAY || MICROPY_PY_ARRAY\nstatic mp_obj_array_t *array_new\\(char typecode, size_t n\\) {\n    int typecode_size = mp_binary_get_size\\(''@'', typecode, NULL\\);\n    mp_obj_array_t *o = m_new_obj\\(mp_obj_array_t\\);\n''@\n\n$newArrayNew = @''\n#if MICROPY_PY_BUILTINS_BYTEARRAY || MICROPY_PY_ARRAY\nstatic mp_obj_array_t *array_new\\(char typecode, size_t n\\) {\n    int typecode_size = mp_binary_get_size\\(''@'', typecode, NULL\\);\n    // Check for integer overflow: typecode_size * n must not overflow size_t\n    // This prevents heap overflow when a malicious __len__ returns a huge value\n    if \\(n > 0 && \\(size_t\\)typecode_size > SIZE_MAX / n\\) {\n        mp_raise_msg\\(&mp_type_OverflowError, MP_ERROR_TEXT\\(\"\"array too large\"\"\\)\\);\n    }\n    mp_obj_array_t *o = m_new_obj\\(mp_obj_array_t\\);\n''@\n\n$content = $content.Replace\\($oldArrayNew, $newArrayNew\\)\n\n# Fix 2: Add bounds checking in array_extend_impl\n$oldExtend = @''\n#if MICROPY_PY_BUILTINS_BYTEARRAY || MICROPY_PY_ARRAY\nstatic void array_extend_impl\\(mp_obj_array_t *array, mp_obj_t arg, char typecode, size_t len\\) {\n    mp_obj_t iterable = mp_getiter\\(arg, NULL\\);\n    mp_obj_t item;\n    size_t i = 0;\n    while \\(\\(item = mp_iternext\\(iterable\\)\\) != MP_OBJ_STOP_ITERATION\\) {\n        if \\(len == 0\\) {\n            array_append\\(MP_OBJ_FROM_PTR\\(array\\), item\\);\n        } else {\n            mp_binary_set_val_array\\(typecode, array->items, i++, item\\);\n        }\n    }\n}\n''@\n\n$newExtend = @''\n#if MICROPY_PY_BUILTINS_BYTEARRAY || MICROPY_PY_ARRAY\n// Helper to safely extend an array from an iterable, checking bounds when len is provided\nstatic void array_extend_impl\\(mp_obj_array_t *array, mp_obj_t arg, char typecode, size_t len\\) {\n    mp_obj_t iterable = mp_getiter\\(arg, NULL\\);\n    mp_obj_t item;\n    size_t i = 0;\n    while \\(\\(item = mp_iternext\\(iterable\\)\\) != MP_OBJ_STOP_ITERATION\\) {\n        if \\(len == 0\\) {\n            // Unknown length - use append which handles resizing safely\n            array_append\\(MP_OBJ_FROM_PTR\\(array\\), item\\);\n        } else {\n            // Check that we don''t exceed the preallocated length\n            // This prevents buffer overflow when iterator yields more items than __len__ claimed\n            if \\(i >= len\\) {\n                mp_raise_msg\\(&mp_type_ValueError, MP_ERROR_TEXT\\(\"\"iterator length mismatch\"\"\\)\\);\n            }\n            mp_binary_set_val_array\\(typecode, array->items, i++, item\\);\n        }\n    }\n}\n''@\n\n$content = $content.Replace\\($oldExtend, $newExtend\\)\n\nSet-Content ''py/objarray.c'' -Value $content -NoNewline\n\")",
      "Bash(/c/Users/bob43/AppData/Local/Programs/Python/Python312/python.exe:*)"
    ],
    "deny": [],
    "ask": []
  }
}
